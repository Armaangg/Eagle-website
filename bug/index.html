<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eagle - Bug</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      background-color: black;
      color: gold;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 70vh;
      padding: 5vw;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      cursor: url('https://i.ibb.co/8nXnxD6r/New-Project-58-9-C5-DF37.png') 0 0, auto;
      padding-top: 80px;
    }

    h1 {
      font-size: clamp(2rem, 5vw, 4rem);
      margin-bottom: 1rem;
    }

    h2 {
      margin-bottom: 1rem;
    }

    p {
      font-size: clamp(1rem, 3vw, 1.5rem);
      max-width: 90%;
      margin-bottom: 2rem;
    }

    button {
      display: inline-block;
      padding: 0.9em 1.7em;
      background-color: gold;
      color: black;
      text-decoration: none;
      border-radius: 0.5em;
      font-weight: bold;
      font-size: clamp(1rem, 2.5vw, 1.25rem);
      transition: background-color 0.3s ease;
      cursor: url('https://i.ibb.co/8nXnxD6r/New-Project-58-9-C5-DF37.png') 0 0, pointer;
      z-index: 8;
      border: none;
    }

    button:hover {
      background-color: #e6c200;
    }

    .img {
      pointer-events: none;
      height: 100px;
      border: 3px solid gold;
      border-radius: 50px;
      padding: 10px;
      box-shadow: 0 0 30px gold;
    }

    .topbar {
      display: flex;
      background: #111;
      color: white;
      width: 100%;
      height: 60px;
      position: fixed;
      z-index: 99;
      top: 0px;
      box-shadow: 0 0 30px gold;
    }

    .brand {
      display: flex;
      gap: 10px;
      justify-content: flex-start;
      position: fixed;
      align-items: center;
      left: 20px;
      top: 8px;
    }

    .brand img {
      height: 40px;
      width: 40px;
      border-radius: 50%;
      pointer-events: none;
      left: 10px;
    }
    .brand span {
      font-size: 20px;
      font-weight: bold;
      top: 10px;
    }

    .hamburger {
      font-size: 34px;
      position: absolute;
      cursor: pointer;
      user-select: none;
      right: 30px;
      top: 9px;
    }

    .sidemenu {
      padding-top: 100px;
      position: fixed;
      top: 0;
      right: -250px;
      width: 250px;
      height: 100vh;
      background: #222;
      color: black;
      display: flex;
      flex-direction: column;
      padding-top: 60px;
      gap: 20px;
      transition: right 0.3s ease;
      z-index: 9;
      align-items: center;
      text-align: center;
    }

    .sidemenu button {
      color: black;
      text-decoration: none;
      transition: background 0.2s;
      display: inline-block;
      width: 85%;
      background-color: gold;
      color: black;
      text-decoration: none;
      font-weight: bold;
      font-size: clamp(1rem, 2.5vw, 1.25rem);
      transition: background-color 0.3s ease;
      cursor: url('https://i.ibb.co/8nXnxD6r/New-Project-58-9-C5-DF37.png') 0 0, pointer;
      border: none;
    }

    .sidemenu a:hover {
      background: #444;
    }

    span {
      color: gold;
    }

    input {
      background-color: gold;
      min-height: 30px;
      border-radius: 10px;
      border: none;
      padding: 5px 10px;
      width: 300px;
      max-width: 90vw;
      font-size: 1rem;
    }

    textarea {
      background-color: gold;
      min-height: 80px;
      border-radius: 10px;
      padding: 10px;
      border: none;
      width: 300px;
      max-width: 90vw;
      font-size: 1rem;
      resize: vertical;
    }

    .file2 {
      display: none;
    }

    /* Upload Attachment button */
    .upload-btn {
      display: inline-block;
      padding: 0.9em 1.7em;
      background-color: gold;
      color: black;
      text-decoration: none;
      border-radius: 0.5em;
      font-weight: bold;
      font-size: clamp(1rem, 2.5vw, 1.25rem);
      transition: background-color 0.3s ease;
      cursor: url('https://i.ibb.co/8nXnxD6r/New-Project-58-9-C5-DF37.png') 0 0, pointer;
      border: none;
      margin-bottom: 20px;
      user-select: none;
    }
    .upload-btn:hover {
      background-color: #e6c200;
    }

    /* Popup Styles */
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: black;
      color: gold;
      border: 2px solid gold;
      padding: 20px 30px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 0 25px gold;
      opacity: 0;
      z-index: 99999;
      transition: all 0.4s ease;
      font-size: 1.2rem;
      max-width: 90%;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .popup.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
      pointer-events: auto;
    }

    

    input[type="text"],
    textarea {
      background-color: gold;
      border: none;
      border-radius: 10px;
      min-height: 30px;
      padding: 5px 10px;
      font-size: 1rem;
      width: 300px;
      max-width: 90vw;
      resize: vertical;
      margin-bottom: 15px;
    }

    .attachment-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      max-width: 350px;
      margin-left: auto;
      margin-right: auto;
    }

    .attachment-group label {
      flex-grow: 1;
      cursor: pointer;
      background-color: gold;
      color: black;
      padding: 0.7em 1em;
      border-radius: 0.5em;
      font-weight: bold;
      font-size: clamp(1rem, 2.5vw, 1.1rem);
      text-align: center;
    }

    .attachment-group input[type="file"] {
      display: none;
    }

    .remove-attachment-btn {
      background: transparent;
      border: none;
      color: gold;
      font-weight: bold;
      font-size: 1.3rem;
      cursor: pointer;
      user-select: none;
      padding: 0;
      line-height: 1;
      transition: color 0.3s ease;
    }

    .remove-attachment-btn:hover {
      color: #e6c200;
    }

    #addAttachmentBtn {
      margin-bottom: 25px;
    }

    /* Popup Styles (unchanged) */
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: black;
      color: gold;
      border: 2px solid gold;
      padding: 20px 30px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 0 25px gold;
      opacity: 0;
      z-index: 99999;
      transition: all 0.4s ease;
      font-size: 1.2rem;
      max-width: 90%;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .popup.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
      pointer-events: auto;
    }

    .spinner {
      border: 3px solid rgba(255, 215, 0, 0.3);
      border-top: 3px solid gold;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    .close-btn {
      cursor: pointer;
      background: transparent;
      border: none;
      color: gold;
      font-size: 1.5rem;
      font-weight: bold;
      line-height: 1;
      padding: 0;
      margin-left: 10px;
      user-select: none;
      transition: color 0.3s ease;
    }

    .close-btn:hover {
      color: #e6c200;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <img src="https://i.ibb.co/sf7YQpM/New-Project-62-CE20679.png" alt="EAGLE LOGO" />
      <span>Eagle</span>
    </div>
    <div class="hamburger" onclick="toggleMenu()">☰</div>
  </div>

  <div class="sidemenu" id="menu">
    <br />
    <button onclick="btn('/')">Home</button>
    <button onclick="btn('/invite')">Invite</button>
    <button onclick="btn('/status')">Status</button>
    <button onclick="btn('/support')">Support</button>
    <button onclick="btn('/team')">Team</button>
    <button onclick="btn('/commands')">Commands</button>
    <button style="box-shadow: 0 0 20px gold;">Bug</button>
    <button onclick="btn('/suggestion')">Suggestion</button>
  </div>

  <h2>Submit a New Bug</h2>
  <form id="bugForm" autocomplete="off">
    <label>
      Title:<br />
      <input type="text" name="title" required />
    </label>
    <br />
    <label>
      Description:<br />
      <textarea name="description" required></textarea>
    </label>

    <div id="attachmentsContainer"></div>

    <button type="button" id="addAttachmentBtn">Add Attachment</button>
    <br />
    <button type="submit">Submit</button>
  </form>

  <p id="status" style="min-height: 1.5rem; margin-top: 15px;"></p>

  <div id="submittingPopup" class="popup">
    <div class="spinner"></div>
    Submitting...
  </div>

  <div id="submittedPopup" class="popup">
    ✅ Bug submitted successfully!
    <button class="close-btn" aria-label="Close">&times;</button>
  </div>

  <script>
    // Cookie functions
    function setCookie(name, value, minutes) {
      const d = new Date();
      d.setTime(d.getTime() + minutes * 60 * 1000);
      document.cookie = name + "=" + value + ";expires=" + d.toUTCString() + ";path=/";
    }

    function getCookie(name) {
      const cookies = document.cookie.split(";").map((c) => c.trim());
      for (const cookie of cookies) {
        if (cookie.startsWith(name + "=")) {
          return cookie.substring(name.length + 1);
        }
      }
      return null;
    }

    function formatRemainingTime(ms) {
      const totalSeconds = Math.ceil(ms / 1000);
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      if (minutes > 0) {
        return `${minutes}m ${seconds}s`;
      } else {
        return `${seconds}s`;
      }
    }

    function showPopup(popup, duration = 2000) {
      popup.classList.add("show");
      if (duration > 0) {
        setTimeout(() => {
          popup.classList.remove("show");
        }, duration);
      }
    }

    function toggleMenu() {
      const menu = document.getElementById("menu");
      menu.style.right = menu.style.right === "0px" ? "-250px" : "0px";
    }

    

    // Attachments handling
    const attachmentsContainer = document.getElementById("attachmentsContainer");
    const addAttachmentBtn = document.getElementById("addAttachmentBtn");

    let attachmentCount = 0;

    function createAttachmentInput() {
      attachmentCount++;

      const div = document.createElement("div");
      div.className = "attachment-group";

      // Create label/button for file input
      const label = document.createElement("label");
      label.textContent = "Choose file";
      label.setAttribute("for", `fileinput${attachmentCount}`);

      // Create hidden file input
      const input = document.createElement("input");
      input.type = "file";
      input.id = `fileinput${attachmentCount}`;
      input.name = "file"; // all named "file" but separate FormData per request
      input.accept = "*/*";

      // When a file is selected, show its name in label
      input.addEventListener("change", () => {
        if (input.files.length > 0) {
          label.textContent = input.files[0].name;
        } else {
          label.textContent = "Choose file";
        }
      });

      // Remove button
      const removeBtn = document.createElement("button");
      removeBtn.type = "button";
      removeBtn.className = "remove-attachment-btn";
      removeBtn.textContent = "×";
      removeBtn.title = "Remove attachment";
      removeBtn.addEventListener("click", () => {
        attachmentsContainer.removeChild(div);
      });

      div.appendChild(label);
      div.appendChild(input);
      div.appendChild(removeBtn);

      attachmentsContainer.appendChild(div);
    }

    addAttachmentBtn.addEventListener("click", () => {
      createAttachmentInput();
    });

    // Submitted popup close button
    const submittedPopup = document.getElementById("submittedPopup");
    const closeBtn = submittedPopup.querySelector(".close-btn");
    closeBtn.addEventListener("click", () => {
      submittedPopup.classList.remove("show");
    });

    // Main form submit handler
    document.getElementById("bugForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const status = document.getElementById("status");
      status.textContent = "";

      // Rate limit check
      const lastSubmitted = getCookie("lastBugTime");
      if (lastSubmitted) {
        const lastTime = parseInt(lastSubmitted, 10);
        const now = Date.now();
        const diff = now - lastTime;
        const waitMinutes = 5;
        if (diff < waitMinutes * 60 * 1000) {
          const remainingMs = waitMinutes * 60 * 1000 - diff;
          const formatted = formatRemainingTime(remainingMs);
          status.textContent = `❌ Please wait ${formatted} before submitting another suggestion.`;
          return;
        }
      }

      // Show submitting popup
      const submittingPopup = document.getElementById("submittingPopup");
      showPopup(submittingPopup, 0);

      const form = e.target;
      const title = form.title.value.trim();
      const description = form.description.value.trim();

      // Gather all attachment inputs
      const fileInputs = Array.from(attachmentsContainer.querySelectorAll('input[type="file"]'));

      // Helper function to send one suggestion POST request
      async function sendBug(currTitle, currDescription, file) {
        const formData = new FormData();
        formData.append("title", currTitle);
        formData.append("description", currDescription);
        if (file) {
          formData.append("file", file);
        }

        const response = await fetch("https://eagle3.armaanop589.workers.dev/bug", {
          method: "POST",
          headers: {
            Accept: "application/json",
          },
          body: formData,
        });

        if (!response.ok) {
          const text = await response.text();
          throw new Error(`Error ${response.status}: ${text}`);
        }
      }

      try {
        // First request - main title + description + first attachment or no attachment
        if (fileInputs.length === 0) {
          // No attachments, send single request
          await sendBug(title, description, null);
        } else {
          // Send first attachment with main title
          await sendBug(title, description, fileInputs[0].files[0]);

          // Send remaining attachments one by one with modified titles
          const suffixes = ["Second", "Third", "Fourth", "Fifth", "Sixth", "Seventh", "Eighth", "Ninth", "Tenth"];
          for (let i = 1; i < fileInputs.length; i++) {
            const suffix = suffixes[i - 1] || `${i + 1}th`;
            const modTitle = `${suffix} Attachment for ${title}`;
            const file = fileInputs[i].files[0];
            await sendSuggestion(modTitle, description, file);
          }
        }

        submittingPopup.classList.remove("show");
        showPopup(submittedPopup, 2500);

        // Reset form and attachments
        form.reset();
        attachmentsContainer.innerHTML = "";
        status.textContent = "";

        // Reset rate limit cookie
        setCookie("lastBugTime", Date.now(), 5);
      } catch (error) {
        submittingPopup.classList.remove("show");
        status.textContent = `❌ Submission failed: ${error.message}`;
      }
    });

    
  </script>
  <script>
(function () {
  let img;
  let offset = 50; // Half of 100px image size
  let isMoving = false;
  let lastX = 0, lastY = 0;

  function createImage(x, y) {
    if (!img) {
      img = document.createElement("img");
      img.src = "https://i.ibb.co/sdSGJS3s/IMG-20250731-210746.png";
      img.style.position = "fixed";
      img.style.width = "100px";
      img.style.height = "100px";
      img.style.zIndex = "9999";
      img.style.pointerEvents = "none";
      img.style.transition = "transform 0s"; // no delay
      img.style.left = "0px";  // Initial anchor
      img.style.top = "0px";
      document.body.appendChild(img);
    }
    updateImagePosition(x, y);
  }

  function updateImagePosition(x, y) {
    lastX = x - offset;
    lastY = y - offset;

    if (!isMoving) {
      isMoving = true;
      requestAnimationFrame(() => {
        if (img) {
          img.style.transform = `translate(${lastX}px, ${lastY}px)`;
        }
        isMoving = false;
      });
    }
  }

  function startTouch(e) {
    if (e.touches.length > 0) {
      const touch = e.touches[0];
      createImage(touch.clientX, touch.clientY);
    }
  }

  function moveTouch(e) {
    if (!img || e.touches.length !== 1) return;

    const touch = e.touches[0];
    updateImagePosition(touch.clientX, touch.clientY);
  }

  function endTouch() {
    if (img) {
      img.remove();
      img = null;
    }
  }

  document.addEventListener("touchstart", startTouch, { passive: true });
  document.addEventListener("touchmove", moveTouch, { passive: true });
  document.addEventListener("touchend", endTouch, { passive: true });
})();
</script>

  <script>
    function toggleMenu() {
      const menu = document.getElementById("menu");
      menu.style.right = menu.style.right === "0px" ? "-250px" : "0px";
    }
  </script>
  <script>
function btn(url) {
  const gifContainer = document.createElement("div");
  gifContainer.style.position = "fixed";
  gifContainer.style.top = "50%";
  gifContainer.style.left = "50%";
  gifContainer.style.transform = "translate(-50%, -50%) scale(0.8)";
  gifContainer.style.pointerEvents = "none";
  gifContainer.style.zIndex = "999999";

  const gif = document.createElement("img");
  gif.src = "https://i.ibb.co/LDdzYh24/ezgif-844ffdf8a067b8.gif";
  gif.style.pointerEvents = "none";

  gifContainer.appendChild(gif);
  document.body.appendChild(gifContainer);

  setTimeout(() => {
    window.location.href = url;
  }, 5000);
}
</script>
</body>
</html>